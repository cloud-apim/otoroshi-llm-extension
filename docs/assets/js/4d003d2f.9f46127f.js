"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[1646],{9431:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var i=t(4848),o=t(8453);t(9229);const a={sidebar_position:6},s="\ud83c\udf3f Ecological impact",l={id:"cost-optimizations/ecological",title:"\ud83c\udf3f Ecological impact",description:"If you want to track the ecological impact of your LLM Usage, you can enable it in the Otoroshi LLM Extension (it should be enabled by default)",source:"@site/docs/cost-optimizations/ecological.mdx",sourceDirName:"cost-optimizations",slug:"/cost-optimizations/ecological",permalink:"/otoroshi-llm-extension/docs/cost-optimizations/ecological",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Reporting",permalink:"/otoroshi-llm-extension/docs/cost-optimizations/reporting"},next:{title:"\ud83d\udee1\ufe0f Guardrails",permalink:"/otoroshi-llm-extension/docs/category/\ufe0f-guardrails"}},r={},c=[{value:"Example of ecological impact embed in responses",id:"example-of-ecological-impact-embed-in-responses",level:2},{value:"Example of LLMUsageAudit event with ecological impact",id:"example-of-llmusageaudit-event-with-ecological-impact",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"-ecological-impact",children:"\ud83c\udf3f Ecological impact"}),"\n",(0,i.jsx)(e.p,{children:"If you want to track the ecological impact of your LLM Usage, you can enable it in the Otoroshi LLM Extension (it should be enabled by default)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-conf",children:'impacts {\n  enabled = true\n  enabled = ${?CLOUD_APIM_EXTENSIONS_LLM_EXTENSION_IMPACTS_ENABLED}\n  embed-description-in-json = true\n  embed-description-in-json = ${?CLOUD_APIM_EXTENSIONS_LLM_EXTENSION_IMPACTS_EMBED_DESCRIPTION_IN_JSON}\n  electricity-mix = "WOR"\n  electricity-mix = ${?CLOUD_APIM_EXTENSIONS_LLM_EXTENSION_IMPACTS_ELECTRICITY_MIX}\n  embed-impacts-in-responses = false\n  embed-impacts-in-responses = ${?CLOUD_APIM_EXTENSIONS_LLM_EXTENSION_IMPACTS_EMBED_IMPACTS_IN_RESPONSES}\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["Once it's enabled, audit events of kind ",(0,i.jsx)(e.code,{children:"LLMUsageAudit"})," will have an ",(0,i.jsx)(e.code,{children:"impacts"}),".\nYou can also embed the ",(0,i.jsx)(e.code,{children:"impacts"})," value in your LLM responses using the ",(0,i.jsx)(e.code,{children:"impacts.embed-impacts-in-responses"})," config.\nPlease remember that the ",(0,i.jsx)(e.code,{children:"impacts"})," value is just an estimate of the real ecological impact of your LLM usage."]}),"\n",(0,i.jsxs)(e.p,{children:["The ecological impact computation is based on project ",(0,i.jsx)(e.a,{href:"https://ecologits.ai/latest/",children:"EcoLogits"})," and only supports right now the following providers"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Mistral"}),"\n",(0,i.jsx)(e.li,{children:"Gemini"}),"\n",(0,i.jsx)(e.li,{children:"Anthropic"}),"\n",(0,i.jsx)(e.li,{children:"OpenAI"}),"\n",(0,i.jsx)(e.li,{children:"Cohere"}),"\n",(0,i.jsx)(e.li,{children:"HuggingFace"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"but if you're okay with approximations, you can set some metadata on your providers to use supported providers / models"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"eco-impacts-electricity-mix-zone"}),": the country where the model is hosted"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"eco-impacts-provider"}),": the provider used for eco impacts computation"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"eco-impacts-model"}),": the model used for eco impacts computation"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"example-of-ecological-impact-embed-in-responses",children:"Example of ecological impact embed in responses"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-sh",children:'$ curl --request POST \\\n  --url \'http://test.oto.tools:8080/v1/chat/completions?embed_impacts=true\' \\\n  --header \'content-type: application/json\' \\\n  --data \'{\n  "messages": [\n    {\n      "role": "user",\n      "content": "tell me a joke"\n    }\n  ]\n}\'\n\n{\n  "id": "chatcmpl-POPo2920QC8UdFT6MEF8MnnMBOGXDNdg",\n  "object": "chat.completion",\n  "created": 1743161221,\n  "model": "gpt-4o-mini",\n  "system_fingerprint": "fp-8hSBjQkQnl3InFEJ88ckzfm3JUtNC2bH",\n  "choices": [\n    {\n      "index": 0,\n      "message": {\n        "role": "assistant",\n        "content": "Why did the scarecrow win an award?\\n\\nBecause he was outstanding in his field!"\n      },\n      "logprobs": null,\n      "finish_reason": "stop"\n    }\n  ],\n  "usage": {\n    "prompt_tokens": 11,\n    "completion_tokens": 18,\n    "total_tokens": 29,\n    "completion_tokens_details": {\n      "reasoning_tokens": 0\n    }\n  },\n  "impacts": {\n    "energy": {\n      "value": {\n        "min": 0.000045859386,\n        "max": 0.000140325354,\n        "avg": 0.00009309237000000001\n      },\n      "unit": "kWh"\n    },\n    "gwp": {\n      "value": {\n        "min": 0.00002877619380504681,\n        "max": 0.00008550637626962295,\n        "avg": 0.00005714128503733488\n      },\n      "unit": "kgCO2eq"\n    },\n    "adpe": {\n      "value": {\n        "min": 1.183887945516329e-10,\n        "max": 1.8973743554267144e-10,\n        "avg": 1.5406311504715217e-10\n      },\n      "unit": "kgSbeq"\n    },\n    "pe": {\n      "value": {\n        "min": 0.00047959646949585386,\n        "max": 0.001435187811341041,\n        "avg": 0.0009573921404184475\n      },\n      "unit": "MJ"\n    },\n    "usage": {\n      "energy": {\n        "value": {\n          "min": 0.000045859386,\n          "max": 0.000140325354,\n          "avg": 0.00009309237000000001\n        },\n        "unit": "kWh"\n      },\n      "gwp": {\n        "value": {\n          "min": 0.000027078958526507997,\n          "max": 0.00008285903437921199,\n          "avg": 0.000054968996452859996\n        },\n        "unit": "kgCO2eq"\n      },\n      "adpe": {\n        "value": {\n          "min": 3.3830835927287995e-12,\n          "max": 1.0351913624863199e-11,\n          "avg": 6.8674986087959995e-12\n        },\n        "unit": "kgSbeq"\n      },\n      "pe": {\n        "value": {\n          "min": 0.000458043547368,\n          "max": 0.001401569635752,\n          "avg": 0.00092980659156\n        },\n        "unit": "MJ"\n      }\n    },\n    "embodied": {\n      "gwp": {\n        "value": {\n          "min": 0.0000016972352785388126,\n          "max": 0.000002647341890410959,\n          "avg": 0.0000021722885844748857\n        },\n        "unit": "kgCO2eq"\n      },\n      "adpe": {\n        "value": {\n          "min": 1.150057109589041e-10,\n          "max": 1.7938552191780823e-10,\n          "avg": 1.4719561643835617e-10\n        },\n        "unit": "kgSbeq"\n      },\n      "pe": {\n        "value": {\n          "min": 0.00002155292212785388,\n          "max": 0.0000336181755890411,\n          "avg": 0.00002758554885844749\n        },\n        "unit": "MJ"\n      }\n    },\n    "warnings": null\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"example-of-llmusageaudit-event-with-ecological-impact",children:"Example of LLMUsageAudit event with ecological impact"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "@id" : "1905575568334651655",\n  "@timestamp" : 1743159594030,\n  "@type" : "AuditEvent",\n  "@product" : "otoroshi",\n  "@serviceId" : "",\n  "@service" : "Otoroshi",\n  "@env" : "dev",\n  "audit" : "LLMUsageAudit",\n  "provider_kind" : "openai",\n  "provider" : "provider_10bbc76d-7cd8-4cb7-b760-61e749a1b691",\n  "duration" : 497,\n  "model" : "gpt-4o-mini",\n  "rate_limit" : {\n    "requests_limit" : 10000,\n    "requests_remaining" : 9998,\n    "tokens_limit" : 200000,\n    "tokens_remaining" : 199993\n  },\n  "usage" : {\n    "prompt_tokens" : 11,\n    "generation_tokens" : 18,\n    "reasoning_tokens" : 0\n  },\n  "error" : null,\n  "consumed_using" : "chat/completion/blocking",\n  "user" : null,\n  "apikey" : null,\n  "route" : {\n    "_loc" : {\n      "tenant" : "default",\n      "teams" : [ "default" ]\n    },\n    "id" : "route_e4a9d6cb3-d859-4203-a860-8d1dd6d09557",\n    "name" : "test",\n    "description" : "A new route",\n    "tags" : [ ],\n    "metadata" : {\n      "created_at" : "2025-03-28T10:10:19.448+01:00",\n      "updated_at" : "2025-03-28T10:48:48.218+01:00"\n    },\n    "enabled" : true,\n    "debug_flow" : false,\n    "export_reporting" : false,\n    "capture" : false,\n    "groups" : [ "default" ],\n    "bound_listeners" : [ ],\n    "frontend" : {\n      "domains" : [ "test.oto.tools" ],\n      "strip_path" : true,\n      "exact" : false,\n      "headers" : { },\n      "query" : { },\n      "methods" : [ ]\n    },\n    "backend" : {\n      "targets" : [ {\n        "id" : "target_1",\n        "hostname" : "request.otoroshi.io",\n        "port" : 443,\n        "tls" : true,\n        "weight" : 1,\n        "backup" : false,\n        "predicate" : {\n          "type" : "AlwaysMatch"\n        },\n        "protocol" : "HTTP/1.1",\n        "ip_address" : null,\n        "tls_config" : {\n          "certs" : [ ],\n          "trusted_certs" : [ ],\n          "enabled" : false,\n          "loose" : false,\n          "trust_all" : false\n        }\n      } ],\n      "root" : "/",\n      "rewrite" : false,\n      "load_balancing" : {\n        "type" : "RoundRobin"\n      },\n      "client" : {\n        "retries" : 1,\n        "max_errors" : 20,\n        "retry_initial_delay" : 50,\n        "backoff_factor" : 2,\n        "call_timeout" : 30000,\n        "call_and_stream_timeout" : 120000,\n        "connection_timeout" : 10000,\n        "idle_timeout" : 60000,\n        "global_timeout" : 30000,\n        "sample_interval" : 2000,\n        "proxy" : { },\n        "custom_timeouts" : [ ],\n        "cache_connection_settings" : {\n          "enabled" : false,\n          "queue_size" : 2048\n        }\n      },\n      "health_check" : {\n        "enabled" : false,\n        "url" : "",\n        "timeout" : 5000,\n        "healthyStatuses" : [ ],\n        "unhealthyStatuses" : [ ]\n      }\n    },\n    "backend_ref" : null,\n    "plugins" : [ {\n      "enabled" : true,\n      "debug" : false,\n      "plugin" : "cp:otoroshi.next.plugins.OverrideHost",\n      "include" : [ ],\n      "exclude" : [ ],\n      "config" : { },\n      "bound_listeners" : [ ],\n      "plugin_index" : {\n        "transform_request" : 0\n      }\n    }, {\n      "enabled" : true,\n      "debug" : false,\n      "plugin" : "cp:otoroshi_plugins.com.cloud.apim.otoroshi.extensions.aigateway.plugins.OpenAiCompatProxy",\n      "include" : [ ],\n      "exclude" : [ ],\n      "config" : {\n        "refs" : [ "provider_10bbc76d-7cd8-4cb7-b760-61e749a1b691" ]\n      },\n      "bound_listeners" : [ ],\n      "plugin_index" : { }\n    } ]\n  },\n  "input_prompt" : [ {\n    "role" : "user",\n    "content" : "tell me a joke"\n  } ],\n  "output" : {\n    "generations" : [ {\n      "message" : {\n        "role" : "assistant",\n        "content" : "Why did the scarecrow win an award?\\n\\nBecause he was outstanding in his field!"\n      }\n    } ],\n    "metadata" : {\n      "rate_limit" : {\n        "requests_limit" : 10000,\n        "requests_remaining" : 9998,\n        "tokens_limit" : 200000,\n        "tokens_remaining" : 199993\n      },\n      "usage" : {\n        "prompt_tokens" : 11,\n        "generation_tokens" : 18,\n        "reasoning_tokens" : 0\n      }\n    }\n  },\n  "provider_details" : {\n    "_loc" : {\n      "tenant" : "default",\n      "teams" : [ "default" ]\n    },\n    "id" : "provider_10bbc76d-7cd8-4cb7-b760-61e749a1b691",\n    "name" : "OpenAI",\n    "description" : "An OpenAI LLM api provider",\n    "metadata" : {\n      "created_at" : "2025-03-28T10:10:51.558+01:00"\n    },\n    "tags" : [ ],\n    "provider" : "openai",\n    "connection" : {\n      "base_url" : "https://api.openai.com/v1",\n      "token" : "xxx",\n      "timeout" : 30000\n    },\n    "options" : {\n      "model" : "gpt-4o-mini",\n      "frequency_penalty" : null,\n      "logit_bias" : null,\n      "logprobs" : null,\n      "top_logprobs" : null,\n      "max_tokens" : null,\n      "n" : 1,\n      "presence_penalty" : null,\n      "response_format" : null,\n      "seed" : null,\n      "stop" : null,\n      "stream" : false,\n      "temperature" : 1,\n      "top_p" : 1,\n      "tools" : null,\n      "tool_choice" : null,\n      "user" : null,\n      "wasm_tools" : [ ],\n      "mcp_connectors" : [ ],\n      "allow_config_override" : true\n    },\n    "provider_fallback" : null,\n    "context" : {\n      "default" : null,\n      "contexts" : [ ]\n    },\n    "models" : {\n      "include" : [ ],\n      "exclude" : [ ]\n    },\n    "guardrails" : [ ],\n    "guardrails_fail_on_deny" : false,\n    "cache" : {\n      "strategy" : "none",\n      "ttl" : 300000,\n      "score" : 0.8\n    }\n  },\n  "impacts" : {\n    "energy" : {\n      "value" : {\n        "min" : 0.000045859386,\n        "max" : 0.000140325354,\n        "avg" : 0.00009309237000000001\n      },\n      "unit" : "kWh",\n      "description" : "Energy: related to the final electricity consumption in kWh"\n    },\n    "gwp" : {\n      "value" : {\n        "min" : 0.00002877619380504681,\n        "max" : 0.00008550637626962295,\n        "avg" : 0.00005714128503733488\n      },\n      "unit" : "kgCO2eq",\n      "description" : "Global Warming Potential (GWP): related to climate change, commonly known as GHG emissions in kgCO2eq"\n    },\n    "adpe" : {\n      "value" : {\n        "min" : 1.183887945516329E-10,\n        "max" : 1.8973743554267144E-10,\n        "avg" : 1.5406311504715217E-10\n      },\n      "unit" : "kgSbeq",\n      "description" : "Abiotic Depletion Potential for Elements (ADPe): related to the depletion of minerals and metals in kgSbeq"\n    },\n    "pe" : {\n      "value" : {\n        "min" : 0.00047959646949585386,\n        "max" : 0.001435187811341041,\n        "avg" : 0.0009573921404184475\n      },\n      "unit" : "MJ",\n      "description" : "Primary Energy (PE): related to the energy consumed from primary sources like oil, gas or coal in MJ"\n    },\n    "usage" : {\n      "energy" : {\n        "value" : {\n          "min" : 0.000045859386,\n          "max" : 0.000140325354,\n          "avg" : 0.00009309237000000001\n        },\n        "unit" : "kWh",\n        "description" : "Energy: related to the final electricity consumption in kWh"\n      },\n      "gwp" : {\n        "value" : {\n          "min" : 0.000027078958526507997,\n          "max" : 0.00008285903437921199,\n          "avg" : 0.000054968996452859996\n        },\n        "unit" : "kgCO2eq",\n        "description" : "Global Warming Potential (GWP): related to climate change, commonly known as GHG emissions in kgCO2eq"\n      },\n      "adpe" : {\n        "value" : {\n          "min" : 3.3830835927287995E-12,\n          "max" : 1.0351913624863199E-11,\n          "avg" : 6.8674986087959995E-12\n        },\n        "unit" : "kgSbeq",\n        "description" : "Abiotic Depletion Potential for Elements (ADPe): related to the depletion of minerals and metals in kgSbeq"\n      },\n      "pe" : {\n        "value" : {\n          "min" : 0.000458043547368,\n          "max" : 0.001401569635752,\n          "avg" : 0.00092980659156\n        },\n        "unit" : "MJ",\n        "description" : "Primary Energy (PE): related to the energy consumed from primary sources like oil, gas or coal in MJ"\n      },\n      "description" : "related to the impacts of the energy consumption during model execution"\n    },\n    "embodied" : {\n      "gwp" : {\n        "value" : {\n          "min" : 0.0000016972352785388126,\n          "max" : 0.000002647341890410959,\n          "avg" : 0.0000021722885844748857\n        },\n        "unit" : "kgCO2eq",\n        "description" : "Global Warming Potential (GWP): related to climate change, commonly known as GHG emissions in kgCO2eq"\n      },\n      "adpe" : {\n        "value" : {\n          "min" : 1.150057109589041E-10,\n          "max" : 1.7938552191780823E-10,\n          "avg" : 1.4719561643835617E-10\n        },\n        "unit" : "kgSbeq",\n        "description" : "Abiotic Depletion Potential for Elements (ADPe): related to the depletion of minerals and metals in kgSbeq"\n      },\n      "pe" : {\n        "value" : {\n          "min" : 0.00002155292212785388,\n          "max" : 0.0000336181755890411,\n          "avg" : 0.00002758554885844749\n        },\n        "unit" : "MJ",\n        "description" : "Primary Energy (PE): related to the energy consumed from primary sources like oil, gas or coal in MJ"\n      },\n      "description" : "related to resource extraction, manufacturing and transportation of the hardware"\n    },\n    "warnings" : null\n  }\n}\n'})})]})}function u(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},9229:(n,e,t)=>{t(6540),t(4848)},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>l});var i=t(6540);const o={},a=i.createContext(o);function s(n){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),i.createElement(a.Provider,{value:e},n.children)}}}]);
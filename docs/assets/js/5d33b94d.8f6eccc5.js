"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[89],{8144:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var o=t(4848),r=t(8453);t(9229);const a={sidebar_position:4},s="\ud83d\udd10 Secure your LLM provider endpoint",i={id:"llm-gateway/secure-provider",title:"\ud83d\udd10 Secure your LLM provider endpoint",description:"To secure your LLM provider endpoint http8080 for example, you could add API keys.",source:"@site/docs/llm-gateway/secure-provider.mdx",sourceDirName:"llm-gateway",slug:"/llm-gateway/secure-provider",permalink:"/otoroshi-llm-extension/docs/llm-gateway/secure-provider",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"\ud83d\udc40 Expose your LLM Provider",permalink:"/otoroshi-llm-extension/docs/llm-gateway/expose"},next:{title:"Managing secrets",permalink:"/otoroshi-llm-extension/docs/llm-gateway/secrets"}},l={},d=[{value:"Create new API Key",id:"create-new-api-key",level:2},{value:"Full configuration",id:"full-configuration",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"-secure-your-llm-provider-endpoint",children:"\ud83d\udd10 Secure your LLM provider endpoint"}),"\n",(0,o.jsxs)(n.p,{children:["To secure your LLM provider endpoint ",(0,o.jsx)(n.a,{href:"http://openai-demo.oto.tools:8080",children:"http://openai-demo.oto.tools:8080"})," for example, you could add API keys."]}),"\n",(0,o.jsx)(n.p,{children:"To do it so, add the API Keys plugin to your route :"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(5245).A+"",width:"1666",height:"958"})}),"\n",(0,o.jsx)(n.p,{children:"Once added you should see your route as :"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(6612).A+"",width:"1666",height:"958"})}),"\n",(0,o.jsxs)(n.p,{children:["Then, we will try to send a request to our endpoint ",(0,o.jsx)(n.a,{href:"http://openai-demo.oto.tools:8080",children:"http://openai-demo.oto.tools:8080"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:'curl http://openai-demo.oto.tools:8080 \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "messages": [\n      {\n        "role": "user",\n        "content": "Hello how are you ?"\n      }\n    ]\n  }\'\n'})}),"\n",(0,o.jsx)(n.p,{children:"The endpoint will return an error :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n  "Otoroshi-Error": "no apikey"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"That's good ! Because we just use our endpoint without any API Key and our request got rejected."}),"\n",(0,o.jsx)(n.h2,{id:"create-new-api-key",children:"Create new API Key"}),"\n",(0,o.jsxs)(n.p,{children:["Go to ",(0,o.jsx)(n.a,{href:"http://otoroshi.oto.tools:8099/bo/dashboard/apikeys",children:"API Keys dashboard"})," and create a new Key"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(508).A+"",width:"1666",height:"958"})}),"\n",(0,o.jsxs)(n.p,{children:["Go to ",(0,o.jsx)(n.code,{children:"Authorized On"})," section and select your route. ",(0,o.jsx)(n.code,{children:"OpenAI Demo"})," in our example case."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(3488).A+"",width:"1920",height:"957"})}),"\n",(0,o.jsx)(n.p,{children:"Copy the Bearer token that may look like :"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"otoapk_urjyypqbif8gr8wx_701cd2e99c0e2707e44bf6a7bb75518c90700a867d6c22f624020b22434cf7f9"})}),"\n",(0,o.jsx)(n.p,{children:"And then re-send a new request with our Bearer token into our request headers."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:' curl http://openai-demo.oto.tools:8080 \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer otoapk_urjyypqbif8gr8wx_701cd2e99c0e2707e44bf6a7bb75518c90700a867d6c22f624020b22434cf7f9" \\\n  -d \'{\n    "messages": [\n      {\n        "role": "user",\n        "content": "Hello how are you ?"\n      }\n    ]\n  }\'\n'})}),"\n",(0,o.jsx)(n.p,{children:"Ta-da !"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(5429).A+"",width:"938",height:"393"})}),"\n",(0,o.jsx)(n.p,{children:"Here is our real response from the LLM with our authorized API key :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n  "id": "chatcmpl-SySPnMI3VzZKQZbvT42ko0H5YhrcIAVB",\n  "object": "chat.completion",\n  "created": 1743417992,\n  "model": "gpt-4o-mini",\n  "system_fingerprint": "fp-XfvVJ9gJ2viprCxZ1pyq508tukNbuz8u",\n  "choices": [\n    {\n      "index": 0,\n      "message": {\n        "role": "assistant",\n        "content": "Hello! I\'m just a computer program, so I don\'t have feelings, but I\'m here and ready to help you. How can I assist you today?"\n      },\n      "logprobs": null,\n      "finish_reason": "stop"\n    }\n  ],\n  "usage": {\n    "prompt_tokens": 12,\n    "completion_tokens": 31,\n    "total_tokens": 43,\n    "completion_tokens_details": {\n      "reasoning_tokens": 0\n    }\n  }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"We can see in our API Key that the quotas for our API keys has been decreased due our request"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(9220).A+"",width:"1626",height:"325"})}),"\n",(0,o.jsx)(n.h3,{id:"full-configuration",children:"Full configuration"}),"\n",(0,o.jsx)(n.p,{children:"Configuration for the API Key"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n  "_loc": {\n    "tenant": "default",\n    "teams": [\n      "default"\n    ]\n  },\n  "clientId": "urjyypqbif8gr8wx",\n  "clientSecret": "5icbe4o94dbwere7nupoecfmgr5kbo3cgpp0iv94gf1kxak04ocfw9tvu4f9nrmd",\n  "clientName": "Hilario Flatley\'s api-key",\n  "description": "",\n  "authorizedGroup": null,\n  "authorizedEntities": [\n    "route_route_ca396e0a1-2bc6-41c5-a682-2a95c4ed0c24"\n  ],\n  "authorizations": [\n    {\n      "kind": "route",\n      "id": "route_ca396e0a1-2bc6-41c5-a682-2a95c4ed0c24"\n    }\n  ],\n  "enabled": true,\n  "readOnly": false,\n  "allowClientIdOnly": false,\n  "throttlingQuota": 10000000,\n  "dailyQuota": 10000000,\n  "monthlyQuota": 10000000,\n  "constrainedServicesOnly": false,\n  "restrictions": {\n    "enabled": false,\n    "allowLast": true,\n    "allowed": [],\n    "forbidden": [],\n    "notFound": []\n  },\n  "rotation": {\n    "enabled": false,\n    "rotationEvery": 744,\n    "gracePeriod": 168,\n    "nextSecret": null\n  },\n  "validUntil": null,\n  "tags": [],\n  "metadata": {\n    "created_at": "2025-03-31T12:42:40.194+02:00"\n  },\n  "bearer": "otoapk_urjyypqbif8gr8wx_701cd2e99c0e2707e44bf6a7bb75518c90700a867d6c22f624020b22434cf7f9",\n  "kind": "apim.otoroshi.io/ApiKey"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Full route configuration with API Keys plugin :"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n  "_loc": {\n    "tenant": "default",\n    "teams": [\n      "default"\n    ]\n  },\n  "id": "route_ca396e0a1-2bc6-41c5-a682-2a95c4ed0c24",\n  "name": "OpenAI Demo",\n  "description": "OpenAI Demo",\n  "tags": [],\n  "metadata": {},\n  "enabled": true,\n  "debug_flow": false,\n  "export_reporting": false,\n  "capture": false,\n  "groups": [\n    "default"\n  ],\n  "bound_listeners": [],\n  "frontend": {\n    "domains": [\n      "openai-demo.oto.tools"\n    ],\n    "strip_path": true,\n    "exact": false,\n    "headers": {},\n    "query": {},\n    "methods": []\n  },\n  "backend": {\n    "targets": [\n      {\n        "id": "target_1",\n        "hostname": "request.otoroshi.io",\n        "port": 443,\n        "tls": true,\n        "weight": 1,\n        "predicate": {\n          "type": "AlwaysMatch"\n        },\n        "protocol": "HTTP/1.1",\n        "ip_address": null,\n        "tls_config": {\n          "certs": [],\n          "trusted_certs": [],\n          "enabled": false,\n          "loose": false,\n          "trust_all": false\n        }\n      }\n    ],\n    "root": "/",\n    "rewrite": false,\n    "load_balancing": {\n      "type": "RoundRobin"\n    },\n    "client": {\n      "retries": 1,\n      "max_errors": 20,\n      "retry_initial_delay": 50,\n      "backoff_factor": 2,\n      "call_timeout": 30000,\n      "call_and_stream_timeout": 120000,\n      "connection_timeout": 10000,\n      "idle_timeout": 60000,\n      "global_timeout": 30000,\n      "sample_interval": 2000,\n      "proxy": {},\n      "custom_timeouts": [],\n      "cache_connection_settings": {\n        "enabled": false,\n        "queue_size": 2048\n      }\n    },\n    "health_check": {\n      "enabled": false,\n      "url": "",\n      "timeout": 5000,\n      "healthyStatuses": [],\n      "unhealthyStatuses": []\n    }\n  },\n  "backend_ref": null,\n  "plugins": [\n    {\n      "enabled": true,\n      "debug": false,\n      "plugin": "cp:otoroshi.next.plugins.OverrideHost",\n      "include": [],\n      "exclude": [],\n      "config": {},\n      "bound_listeners": [],\n      "plugin_index": {\n        "transform_request": 0\n      }\n    },\n    {\n      "enabled": true,\n      "debug": false,\n      "plugin": "cp:otoroshi_plugins.com.cloud.apim.otoroshi.extensions.aigateway.plugins.OpenAiCompatProxy",\n      "include": [],\n      "exclude": [],\n      "config": {\n        "refs": [\n          "provider_7e618efb-9c2c-42ed-870a-58b1ec3c6264"\n        ]\n      },\n      "bound_listeners": [],\n      "plugin_index": {}\n    },\n    {\n      "enabled": true,\n      "debug": false,\n      "plugin": "cp:otoroshi.next.plugins.ApikeyCalls",\n      "include": [],\n      "exclude": [],\n      "config": {\n        "extractors": {\n          "basic": {\n            "enabled": true,\n            "header_name": null,\n            "query_name": null\n          },\n          "custom_headers": {\n            "enabled": true,\n            "client_id_header_name": null,\n            "client_secret_header_name": null\n          },\n          "client_id": {\n            "enabled": true,\n            "header_name": null,\n            "query_name": null\n          },\n          "jwt": {\n            "enabled": true,\n            "secret_signed": true,\n            "keypair_signed": true,\n            "include_request_attrs": false,\n            "max_jwt_lifespan_sec": null,\n            "header_name": null,\n            "query_name": null,\n            "cookie_name": null\n          }\n        },\n        "routing": {\n          "enabled": false\n        },\n        "validate": true,\n        "mandatory": true,\n        "pass_with_user": false,\n        "wipe_backend_request": true,\n        "update_quotas": true\n      },\n      "bound_listeners": [],\n      "plugin_index": {\n        "validate_access": 0,\n        "transform_request": 1,\n        "match_route": 0\n      }\n    }\n  ],\n  "kind": "proxy.otoroshi.io/Route"\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},9229:(e,n,t)=>{t(6540),t(4848)},3488:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/apikeys-create-authorized-on-a048eb402ed921262f24ec1c016b4d88.png"},508:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/apikeys-create-f5b656e7a13c58dd2a234510aac9e58a.png"},6612:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/apikeys-plugin-added-be510cda6550179a02c19851432ba558.png"},5245:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/apikeys-plugin-fc355d1f06af8cd1a9df1bffb6c21cf2.png"},9220:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/apikeys-quota-consumption-81f8d904ef8e41174452d637a27b0f2b.png"},5429:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/apikeys-secure-good-response-1e7cd552532205d90213ae122da6920d.png"},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var o=t(6540);const r={},a=o.createContext(r);function s(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);
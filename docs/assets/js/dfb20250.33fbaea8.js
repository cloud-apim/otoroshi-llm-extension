"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[952],{6586:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>c,frontMatter:()=>t,metadata:()=>a,toc:()=>u});var o=s(4848),i=s(8453);s(9229);const t={sidebar_position:2},d="\ud83d\udcb0 Budgets Management",a={id:"cost-optimizations/budgets",title:"\ud83d\udcb0 Budgets Management",description:"Budgets management for LLMs with a gateway means monitoring and managing the costs of using different LLMs through an API gateway.",source:"@site/docs/cost-optimizations/budgets.mdx",sourceDirName:"cost-optimizations",slug:"/cost-optimizations/budgets",permalink:"/otoroshi-llm-extension/docs/cost-optimizations/budgets",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"\ud83d\udcb0 Cost tracking",permalink:"/otoroshi-llm-extension/docs/cost-optimizations/cost-tracking"},next:{title:"Managing tokens usage",permalink:"/otoroshi-llm-extension/docs/cost-optimizations/quotas"}},l={},u=[{value:"Configuration",id:"configuration",level:3},{value:"Budgets",id:"budgets",level:3},{value:"Admin API",id:"admin-api",level:3},{value:"Embed in responses",id:"embed-in-responses",level:3}];function r(n){const e={code:"code",h1:"h1",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{id:"-budgets-management",children:"\ud83d\udcb0 Budgets Management"}),"\n",(0,o.jsx)(e.p,{children:"Budgets management for LLMs with a gateway means monitoring and managing the costs of using different LLMs through an API gateway."}),"\n",(0,o.jsx)(e.p,{children:"Our Otoroshi LLM extension helps you optimize usage, control your budget, and improve cost efficiency across models."}),"\n",(0,o.jsx)(e.h3,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-hocon",children:"budgets {\n  enabled = true\n  enabled = ${?CLOUD_APIM_EXTENSIONS_LLM_EXTENSION_BUDGETS_ENABLED}\n  embed-budgets-in-responses = false\n  embed-budgets-in-responses = ${?CLOUD_APIM_EXTENSIONS_LLM_EXTENSION_BUDGETS_EMBED_BUGETS_IN_RESPONSES}\n}\n"})}),"\n",(0,o.jsx)(e.p,{children:"Once it's enabled, you can create budgets from the UI or the admin. API and enforce budget limits to any consumer"}),"\n",(0,o.jsx)(e.h3,{id:"budgets",children:"Budgets"}),"\n",(0,o.jsx)(e.p,{children:"A  budget is defined between a start date and an end date. Limits are applied for a duration that is renewed between the start and end date. Limits can be expressed in USD or in tokens."}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:s(5044).A+"",width:"1195",height:"993"})}),"\n",(0,o.jsx)(e.p,{children:"A budget can defined limits that can be global or per usage (inference, image, audio, video, embedding, moderation)"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:s(7772).A+"",width:"1182",height:"888"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:s(7820).A+"",width:"1448",height:"998"})}),"\n",(0,o.jsxs)(e.p,{children:["A budget is defined for a scope based on pretty much whatever you want (apikey, api group, user, provider, model, request, etc). You can reference a budget in entity metadata using ",(0,o.jsx)(e.code,{children:"ai_budget_ref"})," (apikey, api group, user, provider, auth. module)"]}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:s(8666).A+"",width:"1453",height:"914"})}),"\n",(0,o.jsx)(e.p,{children:"A budget can block requests on exceeded limits or just emit alerts"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.img,{src:s(65).A+"",width:"1233",height:"305"})}),"\n",(0,o.jsx)(e.h3,{id:"admin-api",children:"Admin API"}),"\n",(0,o.jsxs)(e.p,{children:["in addition to the classic admin API endpoints for the ",(0,o.jsx)(e.code,{children:"ai-gateway.extensions.cloud-apim.com/AiBudget"})," entity, you have"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["GET /api/extensions/cloud-apim/extensions/ai-extension/budgets/",":id","/consumption"]}),"\n",(0,o.jsxs)(e.li,{children:["POST /api/extensions/cloud-apim/extensions/ai-extension/budgets/",":id","/consumption/_reset"]}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"the first one will return a response like:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "consumed_total_usd": 0.00188655,\n  "consumed_total_tokens": 8036,\n  "consumed_inference_usd": 0.00188655,\n  "consumed_inference_tokens": 8036,\n  "consumed_image_usd": 0,\n  "consumed_image_tokens": 0,\n  "consumed_audio_usd": 0,\n  "consumed_audio_tokens": 0,\n  "consumed_video_usd": 0,\n  "consumed_video_tokens": 0,\n  "consumed_embedding_usd": 0,\n  "consumed_embedding_tokens": 0,\n  "consumed_moderation_usd": 0,\n  "consumed_moderation_tokens": 0,\n  "remaining_total_usd": 199.99811345,\n  "remaining_total_tokens": 9991964,\n  "remaining_inference_usd": 0,\n  "remaining_inference_tokens": 0,\n  "remaining_image_usd": 0,\n  "remaining_image_tokens": 0,\n  "remaining_audio_usd": 0,\n  "remaining_audio_tokens": 0,\n  "remaining_video_usd": 0,\n  "remaining_video_tokens": 0,\n  "remaining_embedding_usd": 0,\n  "remaining_embedding_tokens": 0,\n  "remaining_moderation_usd": 0,\n  "remaining_moderation_tokens": 0,\n  "allowed_total_usd": 200,\n  "allowed_total_tokens": 10000000,\n  "allowed_inference_usd": null,\n  "allowed_inference_tokens": null,\n  "allowed_image_usd": null,\n  "allowed_image_tokens": null,\n  "allowed_audio_usd": null,\n  "allowed_audio_tokens": null,\n  "allowed_video_usd": null,\n  "allowed_video_tokens": null,\n  "allowed_embedding_usd": null,\n  "allowed_embedding_tokens": null,\n  "allowed_moderation_usd": null,\n  "allowed_moderation_tokens": null\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"embed-in-responses",children:"Embed in responses"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:'curl --request POST \\\n  --url \'http://proxy.oto.tools:8080/v1/chat/completions?embed_budget=true\' \\\n  --header \'content-type: application/json\' \\\n  --data \'{\n  "model": "anthropic/claude-sonnet-4-5-20250929",\n  "stream": false,\n  "messages": [\n    {\n      "role": "user",\n      "content": "tell me a joke ?"\n    }\n  ]\n}\'\n\n{\n  "id": "chatcmpl-9ODWHjtFVS5qzpU1nc79TprfRhZElq0e",\n  "object": "chat.completion",\n  "created": 1762441013,\n  "model": "claude-sonnet-4-5-20250929",\n  "system_fingerprint": "fp-tEQXbmpSPELEh3fYd5Rs9Jf4HIaI3E6s",\n  "choices": [\n    {\n      "index": 0,\n      "message": {\n        "role": "assistant",\n        "content": "Why don\'t scientists trust atoms?\\n\\nBecause they make up everything! \ud83d\ude04"\n      },\n      "logprobs": null,\n      "finish_reason": "stop"\n    }\n  ],\n  "usage": {\n    "prompt_tokens": 12,\n    "completion_tokens": 20,\n    "total_tokens": 32,\n    "completion_tokens_details": {\n      "reasoning_tokens": -1\n    }\n  },\n  "budget": {\n    "consumed_total_usd": 0.00394755,\n    "consumed_total_tokens": 8231,\n    "consumed_inference_usd": 0.00394755,\n    "consumed_inference_tokens": 8231,\n    "consumed_image_usd": 0,\n    "consumed_image_tokens": 0,\n    "consumed_audio_usd": 0,\n    "consumed_audio_tokens": 0,\n    "consumed_video_usd": 0,\n    "consumed_video_tokens": 0,\n    "consumed_embedding_usd": 0,\n    "consumed_embedding_tokens": 0,\n    "consumed_moderation_usd": 0,\n    "consumed_moderation_tokens": 0,\n    "remaining_total_usd": 199.99605245,\n    "remaining_total_tokens": 9991769,\n    "remaining_inference_usd": 0,\n    "remaining_inference_tokens": 0,\n    "remaining_image_usd": 0,\n    "remaining_image_tokens": 0,\n    "remaining_audio_usd": 0,\n    "remaining_audio_tokens": 0,\n    "remaining_video_usd": 0,\n    "remaining_video_tokens": 0,\n    "remaining_embedding_usd": 0,\n    "remaining_embedding_tokens": 0,\n    "remaining_moderation_usd": 0,\n    "remaining_moderation_tokens": 0,\n    "allowed_total_usd": 200,\n    "allowed_total_tokens": 10000000,\n    "allowed_inference_usd": null,\n    "allowed_inference_tokens": null,\n    "allowed_image_usd": null,\n    "allowed_image_tokens": null,\n    "allowed_audio_usd": null,\n    "allowed_audio_tokens": null,\n    "allowed_video_usd": null,\n    "allowed_video_tokens": null,\n    "allowed_embedding_usd": null,\n    "allowed_embedding_tokens": null,\n    "allowed_moderation_usd": null,\n    "allowed_moderation_tokens": null\n  }\n}\n'})})]})}function c(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(r,{...n})}):r(n)}},9229:(n,e,s)=>{s(6540),s(4848)},65:(n,e,s)=>{s.d(e,{A:()=>o});const o=s.p+"assets/images/budgets-action-on-exceed-415bd2b61d46402560c9ea427621ba8c.png"},7820:(n,e,s)=>{s.d(e,{A:()=>o});const o=s.p+"assets/images/budgets-consumptions-af9aa557cbd2ec62065be2d6d187e54e.png"},5044:(n,e,s)=>{s.d(e,{A:()=>o});const o=s.p+"assets/images/budgets-duration-7d2294f7641feb21dded6730d01da406.png"},7772:(n,e,s)=>{s.d(e,{A:()=>o});const o=s.p+"assets/images/budgets-limits-ca069a433974ca9174b48ba02da614f4.png"},8666:(n,e,s)=>{s.d(e,{A:()=>o});const o=s.p+"assets/images/budgets-scope-f343774a9f9d5a64325c6bcc4b2f8588.png"},8453:(n,e,s)=>{s.d(e,{R:()=>d,x:()=>a});var o=s(6540);const i={},t=o.createContext(i);function d(n){const e=o.useContext(t);return o.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:d(n.components),o.createElement(t.Provider,{value:e},n.children)}}}]);